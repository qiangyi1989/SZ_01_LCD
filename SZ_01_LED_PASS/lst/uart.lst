C51 COMPILER V9.00   UART                                                                  05/05/2016 16:13:40 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN .\out\uart.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE uart.c BROWSE DEBUG OBJECTEXTEND PRINT(.\lst\uart.lst) OBJECT(.\out\uart.ob
                    -j)

line level    source

   1          
   2          #include "reg51.h"
   3          #include "intrins.h"
   4          #include "led_display.h"
   5          #include "uart.h"
   6          #include "global.h"
   7          #include "save_cnt.h"
   8          #include "sys.h"
   9          #include <string.h>
  10          
  11          typedef unsigned char BYTE;
  12          typedef unsigned int WORD;
  13          
  14          #define FOSC 11059200L          //ÏµÍ³ÆµÂÊ
  15          #define BAUD 9600             //´®¿Ú²¨ÌØÂÊ
  16          
  17          
  18          //#define BAUD2 115200
  19          
  20          //#define BAUD2         57600                           //9600          
  21          
  22          //#define BAUD2                 38400
  23          
  24          //#define BAUD2  19200                          
  25          
  26          
  27          #define BAUD2 9600
  28          
  29          
  30          
  31          #define  T9_6KHZ  65536-(FOSC/BAUD2/4)          //¶¨ÒåÎª1tÄ£Ê½Ê±,²»Òª³ý12
  32          
  33          
  34          #define NONE_PARITY     0       //ÎÞÐ£Ñé
  35          #define ODD_PARITY      1       //ÆæÐ£Ñé
  36          #define EVEN_PARITY     2       //Å¼Ð£Ñé
  37          #define MARK_PARITY     3       //±ê¼ÇÐ£Ñé
  38          #define SPACE_PARITY    4       //¿Õ°×Ð£Ñé
  39          
  40          #define PARITYBIT NONE_PARITY   //¶¨ÒåÐ£ÑéÎ»
  41          
  42          #define PARITYBIT2 NONE_PARITY   //¶¨ÒåÐ£ÑéÎ»
  43          
  44          //#define UART_REC_FRAME_DELAY 50
  45          #define UART_REC_FRAME_DELAY 10
  46          
  47          extern xdata public_stru public_val;
  48          extern xdata char uart_send_buf[10 + (MENU_ID_00000_MAX_ITEM << 1)];
  49          extern code MENU_ITEM MenuItem[];
  50          extern xdata MENU_CHANG now_menu;
  51          
  52          
  53          extern xdata unsigned int  unUpVerNum;
  54          extern xdata unsigned int  unDownVerNum;
C51 COMPILER V9.00   UART                                                                  05/05/2016 16:13:40 PAGE 2   

  55          extern xdata unsigned int  unIoStatus;
  56          
  57          extern xdata unsigned long  TotalNum;
  58          extern xdata unsigned long  unRow3Data;
  59          
  60          
  61          
  62          //sfr AUXR  = 0x8e;               //¸¨Öú¼Ä´æÆ÷
  63          
  64          //sbit P22 = P2^2;
  65          
  66          bit busy;  /* 1ÕýÔÚ·¢ËÍ£¬0·¢ËÍÍê³É */
  67          
  68          //void SendString(char *s);
  69          
  70          xdata unsigned char Uart_RecBuf[10 + (MENU_ID_00000_MAX_ITEM << 2)];
  71          void * com_data = Uart_RecBuf;
  72          
  73          //add
  74          xdata unsigned char Uart2_RecBuf[10 + (MENU_ID_00000_MAX_ITEM << 2)];
  75          void * com2_data = Uart2_RecBuf;
  76          
  77          bit busy2;  /* 1ÕýÔÚ·¢ËÍ£¬0·¢ËÍÍê³É */
  78          //add
  79          
  80          char temp_char;
  81          
  82          void SendData(BYTE dat);
  83          
  84          //add
  85          void Uasrt2SendData(BYTE dat);
  86          
  87          //add
  88          
  89          //void GpuSend2(char *s);
  90          
  91          
  92          //Ê¹ÓÃt1µÄ16Î»×Ô¶¯ÖØ×°ÔØ×÷Îª´®¿Ú1µÄ²¨ÌØÂÊ·¢ÉúÆ÷
  93          //pcon.7(SMOD)ÓÃ´®ÐÐÍ¨ÐÅ·½Ê½1,2,3µÄ²¨ÌØÂÊ¼Ó±¶,Îª1¼Ó±¶£¬Îª0²»¼Ó±¶
  94          void uart_init()
  95          {
  96   1      #if (PARITYBIT == NONE_PARITY)
  97   1          SCON = 0x50;                //8Î»¿É±ä²¨ÌØÂÊ,·½Ê½1,Ê¹ÄÜ½ÓÊÕ
  98   1      #elif (PARITYBIT == ODD_PARITY) || (PARITYBIT == EVEN_PARITY) || (PARITYBIT == MARK_PARITY)
                  SCON = 0xda;                //9Î»¿É±ä²¨ÌØÂÊ,Ð£ÑéÎ»³õÊ¼Îª1   Í¨ÐÅ·½Ê½3
              #elif (PARITYBIT == SPACE_PARITY)
                      SCON = 0xd2;                //9Î»¿É±ä²¨ÌØÂÊ,Ð£ÑéÎ»³õÊ¼Îª0   Í¨ÐÅ·½Ê½3    (·½Ê½0:8Î»ÒÆÎ»¼Ä´æÆ÷·½Ê½, ·½Ê½2:
             -9Î»,²¨ÌØÂÊ¹Ì¶¨)
              #endif
 103   1      
 104   1          AUXR = 0x40;                //¶¨Ê±Æ÷1Îª1TÄ£Ê½
 105   1          TMOD = 0x00;                //¶¨Ê±Æ÷1ÎªÄ£Ê½0(16Î»×Ô¶¯ÖØÔØ)
 106   1          TL1 = (65536 - (FOSC/4/BAUD));   //ÉèÖÃ²¨ÌØÂÊÖØ×°Öµ //Îª1TÄ£Ê½Ê±£¬ÕâÀï²»Òª³ý12  //´®¿Ú1ÓÃT1×öÎªÆä²¨ÌØÂ
             -Ê·¢ÉúÆ÷,ÇÒT1¹¤×÷ÓÚÄ£Ê½0,Æä²¨ÌØÂÊ=T1µÄÒç³öÂÊ³ýÒÔ4
 107   1          TH1 = (65536 - (FOSC/4/BAUD))>>8;
 108   1          TR1 = 1;                    //¶¨Ê±Æ÷1¿ªÊ¼Æô¶¯
 109   1          ES = 1;                     //Ê¹ÄÜ´®¿ÚÖÐ¶Ï
 110   1          EA = 1;
 111   1              
 112   1              //ÉèÖÃ´®¿Ú1Îª¸ßÓÅÏÈ¼¶ÖÐ¶Ï    //¸ù¾ÝÏàÍ¬ÓÅÏÈ¼¶µÄÄÚ²¿²éÑ¯Ë³´Î: usart1¸ßÓÚusart2, t1¸ßÓÚt2.
 113   1              //µ±Ê¹ÓÃcÓïÑÔ±à³ÌÊ±,ÖÐ¶Ï²éÑ¯Ë³´ÎºÅ,¾ÍÊÇÖÐ¶ÏºÅ.
 114   1              PS = 1;         //add 0331
C51 COMPILER V9.00   UART                                                                  05/05/2016 16:13:40 PAGE 3   

 115   1      }
 116          
 117          
 118          void uart2_init()
 119          {
 120   1              //uart2 ³õÊ¼»¯¶¨Òå
 121   1              //  P_SW2 &= ~ S2_S;    //Ñ¡ÔñÔÚp1.0,p1.1¿Ú
 122   1              
 123   1              //´®¿Ú2¿ØÖÆ¼Ä´æÆ÷
 124   1              //S2CON
 125   1              //S2SM0 - S2SM2 S2REN S2TB8 S2RB8 S2TI S2RI
 126   1              //ÆäÖÐ, S2SM0Îª0,8Î»¿É±ä²¨ÌØÂÊ;Îª1,9Î»¿É±ä²¨ÌØÂÊ
 127   1              //S2SM2ÔÊÐí·½Ê½1¶à»úÍ¨ÐÅ¿ØÖÆÎ»
 128   1              //´®¿Ú2»º³åÇø
 129   1              //S2BUF
 130   1              //´®¿Ú2µÄÖÐ¶ÏÔÊÐíÎ»
 131   1              //ES2   (IE2.0)   IE2:²»¿ÉÎ»Ñ°Ö·
 132   1              
 133   1                AUXR |= 0x04;                 //¶¨Ê±Æ÷2Îª1TÄ£Ê½
 134   1              
 135   1                S2CON = 0x50;
 136   1              
 137   1      /*      
 138   1      #if (PARITYBIT2 == NONE_PARITY)
 139   1          S2CON = 0x50;                //8Î»¿É±ä²¨ÌØÂÊ,·½Ê½1, Ê¹ÄÜ´®¿Ú2½ÓÊÕ
 140   1                      #elif (PARITYBIT2 == ODD_PARITY) || (PARITYBIT == EVEN_PARITY) || (PARITYBIT == MARK_PARITY)   //MARK_PA
             -RITY:±ê¼ÇÐ£Ñé
 141   1          S2CON = 0xda;                //9Î»¿É±ä²¨ÌØÂÊ,Ð£ÑéÎ»³õÊ¼Îª1   Í¨ÐÅ·½Ê½3
 142   1      #elif (PARITYBIT2 == SPACE_PARITY)  //¿Õ°×Ð£Ñé
 143   1                S2CON = 0xd2;                //9Î»¿É±ä²¨ÌØÂÊ,Ð£ÑéÎ»³õÊ¼Îª0   Í¨ÐÅ·½Ê½3    (·½Ê½0:8Î»ÒÆÎ»¼Ä´æÆ÷·½Ê½, ·½Ê
             -½2:9Î»,²¨ÌØÂÊ¹Ì¶¨)
 144   1      #endif
 145   1      */
 146   1                      T2L = T9_6KHZ;                     //³õÊ¼»¯¼ÆÊ±Öµ
 147   1                      T2H = T9_6KHZ >> 8;                                     ////´®¿Ú2ÓÃT2×öÎªÆä²¨ÌØÂÊ·¢ÉúÆ÷,ÇÒT2¹¤×÷ÓÚÄ£Ê½0,Æä²¨ÌØÂÊ=T2µÄÒç³öÂÊ³ýÒÔ4.´®¿Ú2Ö»
             -ÄÜÑ¡ÔñT2.
 148   1                      
 149   1                      AUXR |= 0x10;           //Æô¶¯T2ÔËÐÐ
 150   1                      
 151   1                      IE2 |= 0x1;             //Ê¹ÄÜ´®¿Ú2½ÓÊÕÖÐ¶Ï              //²»ÒªÊ¹ÓÃt2µÄÖÐ¶ÏET2 (ie2.2)
 152   1                      
 153   1                      EA = 1;
 154   1      }
 155          /*----------------------------
 156          UART ÖÐ¶Ï·þÎñ³ÌÐò
 157          -----------------------------*/
 158          //µ±Ê¹ÓÃcÓïÑÔ±à³ÌÊ±,ÖÐ¶Ï²éÑ¯Ë³´ÎºÅ,¾ÍÊÇÖÐ¶ÏºÅ.
 159          void UartRecIsr() interrupt 4 using 1
 160          {
 161   1      
 162   1      //add 0407
 163   1      #ifdef  LCD_UART_DOWN
                      if (RI)
                  {
                      RI = 0;                 //Çå³ýRIÎ»
                              
                              //test 0407
                              //Ê¹ÓÃ´®¿Ú1£¬¶¨ÒåLCD_UART_DOWNÊ±£¬²âÊÔOK.
                              //SendData(SBUF);
                              //test 0407             
                              
                              //ÔÚ´®¿Ú1½ÓÊÕ£¬×ª·¢¸ø´®¿Ú2£¬¶¨ÒåLCD_UART_DOWNÊ±£¬²âÊÔOK.
C51 COMPILER V9.00   UART                                                                  05/05/2016 16:13:40 PAGE 4   

                      Uasrt2SendData(SBUF);           
                  }
                  if (TI)
                  {
                      TI = 0;                 //Çå³ýTIÎ»
                      busy = 0;               //ÇåÃ¦±êÖ¾
                  }   
              #else   
 182   1      //add 0407      
 183   1          if (RI)
 184   1          {
 185   2              RI = 0;                 //Çå³ýRIÎ»
 186   2              Uart_RecBuf[public_val.uart_rec_count++] = SBUF;
 187   2              public_val.uart_rec_statu = 1;
 188   2              public_val.uart_rec_start_timer = public_val.ms_timer;          
 189   2                      
 190   2                      //test 0407
 191   2                      //Ê¹ÓÃ´®¿Ú1£¬ÎÞ¶¨ÒåLCD_UART_DOWNÊ±£¬²âÊÔOK.
 192   2                      //SendData(SBUF);
 193   2                      //test 0407
 194   2                      
 195   2          }
 196   1          if (TI)
 197   1          {
 198   2              TI = 0;                 //Çå³ýTIÎ»
 199   2              busy = 0;               //ÇåÃ¦±êÖ¾
 200   2          }
 201   1      #endif
 202   1      
 203   1      }
 204          
 205          
 206          
 207          
 208          /*----------------------------
 209          UART ÖÐ¶Ï·þÎñ³ÌÐò
 210          -----------------------------*/
 211          
 212          void Uart2RecIsr() interrupt 8 using 1
 213          {
 214   1          if (S2CON & S2RI)
 215   1          {
 216   2                      S2CON &= ~S2RI; //Çå³ýRIÎ»
 217   2              
 218   2                      // Uart2_RecBuf = S2BUF; //»ñÈ¡´®¿ÚÊý¾Ý
 219   2              //public_val.uart_rec_statu = 1;
 220   2              //public_val.uart_rec_start_timer = public_val.ms_timer;
 221   2                      
 222   2                      //add 0407
 223   2                      //´®¿Ú1½ÓÊÕ£¬×ª·¢¸ø´®¿Ú2£¬´®¿Ú2ÊÕµ½ºó£¬·µ»Ø¸ø´®¿Ú1ÏÔÊ¾¡£²âÊÔOK.
 224   2                      #ifdef  LCD_UART_DOWN
                              SendData(S2BUF);
                              #endif
 227   2                      //add 0407
 228   2          }
 229   1          if (S2CON & S2TI)
 230   1          {
 231   2              S2CON &= ~S2TI;                  //Çå³ýTIÎ»
 232   2              busy2 = 0;               //ÇåÃ¦±êÖ¾
 233   2          }
 234   1      }
 235          
C51 COMPILER V9.00   UART                                                                  05/05/2016 16:13:40 PAGE 5   

 236          
 237          
 238          
 239          
 240          
 241          /*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 242          Ãû³Æ:   void check_uart_rec(void)
 243          ¹¦ÄÜ£º  ½ÓÊÕÊý¾ÝÖ¡ÅÐ¶Ï
 244          ²ÎÊý£º  ÎÞ
 245          ·µ»ØÖµ£ºÎÞ
 246          ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/
 247          void check_uart_rec(void)
 248          {
 249   1              if(public_val.uart_rec_statu == 1)
 250   1              {
 251   2                      /* Èç¹û³¬¹ý50msÎ´½ÓÊÕµ½Êý¾Ý£¬ÈÏÎªµ±Ç°Ö¡½ÓÊÕÍê£¬¿ªÊ¼´¦Àí */
 252   2                      if(public_val.ms_timer - public_val.uart_rec_start_timer > UART_REC_FRAME_DELAY)
 253   2                      {
 254   3                              public_val.uart_rec_statu = 2;  /* ÖÃÕýÔÚ´¦Àí×´Ì¬ */
 255   3                      }
 256   2              }
 257   1      }
 258          
 259          /*----------------------------
 260          ·¢ËÍ´®¿ÚÊý¾Ý
 261          ----------------------------*/
 262          void SendData(BYTE dat)
 263          {
 264   1              //del 0407
 265   1      #ifndef LCD_UART_DOWN
 266   1          while (busy);               //µÈ´ýÇ°ÃæµÄÊý¾Ý·¢ËÍÍê³É    //ÏÂÔØÒ³ÃæÐÅÏ¢Ê±£¬while (busy) Óï¾äÐèÆÁ±Î;  //
             -ÔÚ±¾»úÔËÐÐÍ¨ÐÅ(·ÇÓëPC»úÍ¨ÐÅ)Ê±,while (busy) Óï¾ä²»ÄÜÆÁ±Î
 267   1      #endif
 268   1              //del 0407
 269   1          ACC = dat;                  //»ñÈ¡Ð£ÑéÎ»P (PSW.0)
 270   1          if (P)                      //¸ù¾ÝPÀ´ÉèÖÃÐ£ÑéÎ»
 271   1          {
 272   2      #if (PARITYBIT == ODD_PARITY)
                      TB8 = 0;                //ÉèÖÃÐ£ÑéÎ»Îª0
              #elif (PARITYBIT == EVEN_PARITY)
                      TB8 = 1;                //ÉèÖÃÐ£ÑéÎ»Îª1
              #endif
 277   2          }
 278   1          else
 279   1          {
 280   2      #if (PARITYBIT == ODD_PARITY)
                      TB8 = 1;                //ÉèÖÃÐ£ÑéÎ»Îª1
              #elif (PARITYBIT == EVEN_PARITY)
                      TB8 = 0;                //ÉèÖÃÐ£ÑéÎ»Îª0
              #endif
 285   2          }
 286   1          busy = 1;
 287   1          SBUF = ACC;                 //Ð´Êý¾Ýµ½UARTÊý¾Ý¼Ä´æÆ÷
 288   1      }
 289          
 290          /*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 291          Ãû³Æ:   Send_UartBuf(char * buf)
 292          ¹¦ÄÜ£º  Êý¾Ý·¢ËÍ ºÍÐ£Ñé
 293          ²ÎÊý£º  ÎÞ
 294          ·µ»ØÖµ£ºÎÞ
 295          ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/
 296          void Send_UartBuf(char * buf)
C51 COMPILER V9.00   UART                                                                  05/05/2016 16:13:40 PAGE 6   

 297          {
 298   1              int i;
 299   1              static char frame_id = 1;
 300   1              char sum_byte = 0;
 301   1              
 302   1              //buf[0] = (buf[0] & 0x03) | (frame_id << 2);
 303   1              for(i = 0; i < buf[1] + 2; i++)
 304   1              {
 305   2                      sum_byte += buf[i];
 306   2                      SendData(buf[i]);
 307   2              }
 308   1              SendData(sum_byte);
 309   1              frame_id++;
 310   1              if(!frame_id) frame_id = 1;
 311   1      }
 312          
 313          /*----------------------------
 314          ·¢ËÍ×Ö·û´®
 315          ----------------------------*/
 316          /*void SendString(char *s)
 317          {
 318              while (*s)                  //¼ì²â×Ö·û´®½áÊø±êÖ¾
 319              {
 320                  SendData(*s++);         //·¢ËÍµ±Ç°×Ö·û
 321              }
 322          }*/
 323          
 324          /*
 325          void GpuSend2(char *s)
 326          {
 327          //#ifndef       LCD_UART_DOWN
 328          #if 1
 329                  while (*s)                  //¼ì²â×Ö·û´®½áÊø±êÖ¾
 330              {
 331                  Uasrt2SendData(*s++);         //·¢ËÍµ±Ç°×Ö·û
 332              }
 333          #endif  
 334          }
 335          */
 336          
 337          
 338          void GpuSend(char *s)
 339          {
 340   1      //½øÐÐÏÂÔØÊ±£¬ÐèÆÁ±Î
 341   1      #ifndef LCD_UART_DOWN
 342   1      //#if 0
 343   1              while (*s)                  //¼ì²â×Ö·û´®½áÊø±êÖ¾
 344   1          {
 345   2              Uasrt2SendData(*s++);         //·¢ËÍµ±Ç°×Ö·û
 346   2          }
 347   1      #endif  
 348   1      }
 349          
 350          
 351          void Uasrt2SendData(BYTE dat)
 352          {
 353   1              //del 0407
 354   1      #ifndef LCD_UART_DOWN
 355   1              while (busy2);               //    //ÏÂÔØÒ³ÃæÐÅÏ¢Ê±£¬while (busy2) Óï¾äÐèÆÁ±Î; //ÔÚ±¾»úÔËÐÐÍ¨ÐÅ(·ÇÓëPC»úÍ
             -¨ÐÅ)Ê±,while (busy2) Óï¾ä²»ÄÜÆÁ±Î  //µÈ´ýÇ°ÃæµÄÊý¾Ý·¢ËÍÍê³É
 356   1      #endif  
 357   1              //del 0407
C51 COMPILER V9.00   UART                                                                  05/05/2016 16:13:40 PAGE 7   

 358   1          ACC = dat;                  //»ñÈ¡Ð£ÑéÎ»P (PSW.0)
 359   1      
 360   1          if (P)                      //¸ù¾ÝPÀ´ÉèÖÃÐ£ÑéÎ»
 361   1          {
 362   2      #if (PARITYBIT2 == ODD_PARITY)
                      S2TB8 = 0;                //ÉèÖÃÐ£ÑéÎ»Îª0
              #elif (PARITYBIT2 == EVEN_PARITY)
                      S2TB8 = 1;                //ÉèÖÃÐ£ÑéÎ»Îª1
              #endif
 367   2          }
 368   1          else
 369   1          {
 370   2      #if (PARITYBIT2 == ODD_PARITY)
                      S2TB8 = 1;                //ÉèÖÃÐ£ÑéÎ»Îª1
              #elif (PARITYBIT2 == EVEN_PARITY)
                      S2TB8 = 0;                //ÉèÖÃÐ£ÑéÎ»Îª0
              #endif
 375   2          }
 376   1              
 377   1          busy2 = 1;
 378   1          S2BUF = ACC;                 //Ð´Êý¾Ýµ½UARTÊý¾Ý¼Ä´æÆ÷
 379   1      }
 380          
 381          
 382          #if 0
              /*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
              Ãû³Æ:   void frame_par_func(void)
              ¹¦ÄÜ£º  ²ÎÊý×Ö»ØÖ¡´¦Àí
              ²ÎÊý£º  ÎÞ
              ·µ»ØÖµ£ºÎÞ
              ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/
              static void frame_par_func()
              {
                      if(now_menu.chang_par_flag == 1)
                              {
                                      if( ((rt_updata_menu_stru *)com_data)->Statu == 0x00FF )
                                              {
                                                      now_menu.chang_par_flag = 2;
                                              }
                                      else
                                              {
                                                      now_menu.chang_par_flag = 3;
                                              }
                              }
              }
              
              /*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
              Ãû³Æ:   void frame_info_func(void)
              ¹¦ÄÜ£º  »ØÖ¡ÐÅÏ¢×Ö´¦Àí
              ²ÎÊý£º  ÎÞ
              ·µ»ØÖµ£ºÎÞ
              ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/
              void frame_info_func(void)
              {
                      char menu_id,i;
                      switch(((get_ver_stru *)com_data)->cmd_type)
                              {
                                      case GET_VER_CMD:
                                              public_val.drive_type_com = ((get_ver_stru *)com_data)->ver;
                                              public_val.drive_index_com = ((get_ver_stru *)com_data)->drive_indx;
                                              if(public_val.drive_type_com != public_val.drive_type)
                                                      {
C51 COMPILER V9.00   UART                                                                  05/05/2016 16:13:40 PAGE 8   

                                                              public_val.com_log_step = COMD_LOG_STEP_GET_CFG;
                                                      }
                                              else
                                                      {
                                                              public_val.com_log_step = COMD_LOG_STEP_DOWN;
                                                      }
                                              public_val.send_frame_idx = 0;
                                      break;
                                      case SET_VER_IDX_CMD:
                                              public_val.drive_indx = ((set_ver_idx_stru *)com_data)->ver_idx;
                                              public_val.drive_type = 0; //Çå³ý°æ±¾ºÅ,ÏÂ´ÎÉÏµçÖØÐÂ»ñÈ¡ÅäÖÃ
                                              func_ver_update();
                                      break;
                                      case GET_MENU_CFG_INFO:
                                              menu_id = ((rec_menu_cfg_stru *)com_data)->menu_id;
                                              *((char*)(MenuItem[menu_id].com_max_item)) = ((rec_menu_cfg_stru *)com_data)->menu_count;
                                              for(i = 0; i < *(MenuItem[menu_id].com_max_item); i++)
                                                      {
                                                              MenuItem[menu_id].m_pcfg[i].m_max = 
                                                                      ((rec_menu_cfg_stru *)com_data)->val[i].menu_max;
                                                              MenuItem[menu_id].m_pcfg[i].m_min = 
                                                                      ((rec_menu_cfg_stru *)com_data)->val[i].menu_min;
                                                              MenuItem[menu_id].m_pcfg[i].ext_property = 
                                                                      ((rec_menu_cfg_stru *)com_data)->val[i].ext_property;
                                                      }
                                              func_cfg_update(menu_id);
                                              if(menu_id == MENU_NUM - 1) //Íê³É²Ëµ¥ÅäÖÃÊý¾Ý´«Êä,±£´æ°æ±¾¼°°æ±¾ÐòºÅ
                                                      {
                                                              //debug
                                                              public_val.drive_type = public_val.drive_type_com;
                                                              
                                                              //add 0324 
                                                              unDownVerNum = public_val.drive_type;
                                                              //0324 0324 20:34
                                                              
                                                              public_val.drive_indx = public_val.drive_index_com;
                                                              func_ver_update();
                                                      }
                                      break;
                                      case GET_DEFAUT_VAL:
                                              menu_id = ((rec_menu_cfg_stru *)com_data)->menu_id;
                                              for(i = 0; i < *(MenuItem[menu_id].com_max_item); i++)
                                                      {
                                                              *((int *)MenuItem[menu_id].m_pcfg[i].m_data_vale) = 
                                                                      ((rec_defaut_stru *)com_data)->val[i];
                                                      }
                                              //±£´æ²Ëµ¥Êý¾ÝÖµµ½EEPROM
                                              func_menu_update(menu_id);
                                      break;
                                      case GET_PAR_INFO:
                                              menu_id = ((rec_menu_cfg_stru *)com_data)->menu_id;
                                              for(i = 0; i < *(MenuItem[menu_id].com_max_item); i++)
                                                      {
                                                              *((int *)MenuItem[menu_id].m_pcfg[i].m_data_vale) = 
                                                                      ((rec_defaut_stru *)com_data)->val[i];
                                                      }
                                              //±£´æ²Ëµ¥Êý¾ÝÖµµ½EEPROM
                                              func_menu_update(menu_id);
                                      break;
                                      case GET_STATU_INFO:
                                              public_val.Err_Flag &= 0xf0;
                                              public_val.Err_Flag |= (((rec_statu_stru *)com_data)->err_flag) & 0x0f;
C51 COMPILER V9.00   UART                                                                  05/05/2016 16:13:40 PAGE 9   

                                              public_val.Work_Statu = ((rec_statu_stru *)com_data)->statu_num;
                                              public_val.Work_Pause_Flag = ((rec_statu_stru *)com_data)->pass_flag;
                                              public_val.Other_Bit_Flag = ((rec_statu_stru *)com_data)->other_bit_flag;
                                              public_val.main_disp_val = ((rec_statu_stru *)com_data)->disp_count;
                                              public_val.io_read = ((rec_statu_stru *)com_data)->io_read;
                                              if(public_val.Work_Statu  == WORK_STATU_WAIT)
                                                      {
                                                              public_val.Init_Over = 0;
                                                              public_val.com_log_step = COMD_LOG_STEP_GET_VER;
                                                      }
                                              else if(public_val.Work_Statu  >= WORK_STATU_START)
                                                      {
                                                              public_val.Init_Over = 1;
                                                      }
                                      break;
                              }
              }
              
              #endif
 501          
 502          
 503          
 504          //Óësend_data_funcº¯ÊýÅäºÏÀ´¿´
 505          void rec_data_func(void)
 506          {
 507   1              char i;
 508   1              char sum_byte;
 509   1          char *pcTemp = 0;
 510   1              unsigned long uiCnt;
 511   1      
 512   1              static char ucSaveLearn1 = 0, ucSaveLearn2 = 0;
 513   1      
 514   1              /* ¶ÔÖ÷°å·´À¡µÄÆäËûÖ¡×÷Ð£Ñé */
 515   1              sum_byte = Uart_RecBuf[0];
 516   1              for(i = 1; i < public_val.uart_rec_count - 1; i++)
 517   1              {
 518   2                      sum_byte += Uart_RecBuf[i];
 519   2              }
 520   1      
 521   1              /* Ð£ÑéÊ§°Ü±¨´í·µ»Ø */
 522   1              if(sum_byte != Uart_RecBuf[public_val.uart_rec_count - 1])
 523   1              {
 524   2                      //public_val.Err_Flag = ERR_NUM_ZK_COM_ERR;             
 525   2                      public_val.Err_Flag = LED_CHECK_ERROR;       /* ½ÓÊÕµ½Ð£Ñé´íÎóÖ¡ºó²»·¢ËÍºóÐøÖ¡ */
 526   2      
 527   2                      send_frame_type = UP_REPLY_DONE;  /* ¿ÉÒÔ·¢ËÍÏÂÒ»Ö¡ */
 528   2                      
 529   2                      return;                 
 530   2              }
 531   1      
 532   1      
 533   1              /* Ð£Ñé³É¹¦£¬¶Ô½ÓÊÕÖ¡½øÐÐ´¦Àí */        
 534   1              switch(Uart_RecBuf[0])
 535   1              {
 536   2                      /* ÉÏÐÐÐ´²ÎÊýÖ¡ */
 537   2                      case UP_WRITE_PARAM:
 538   2      
 539   2                              /* »ñÈ¡²ÎÊý¸öÊý */
 540   2                              //Menu_Number[0] = Uart_RecBuf[1] >> 1;    /* ÔØºÉ³¤¶È³ýÒÔ2Îª²ÎÊý¸öÊý */
 541   2                              Menu_Number[0] = (Uart_RecBuf[1] + Uart_RecBuf[2]) >> 1;  //ËùÓÐ²ÎÊý¸öÊý
 542   2                              Menu0_Number = Uart_RecBuf[1] >> 1;                                       //²Ëµ¥0²ÎÊý¸öÊý
 543   2      
C51 COMPILER V9.00   UART                                                                  05/05/2016 16:13:40 PAGE 10  

 544   2                              /* ÌáÈ¡ÏÂ·¢µÄ²ÎÊý */  //½«ÏÂ·¢µÄ²ÎÊý±¸·ÝÒ»·Ý,²¢±£´æµ½public_val.menu_parm[0]²Ëµ¥²ÎÊý»º³åÇø
 545   2                              pcTemp = (char *)&public_val.menu_parm[0];
 546   2                              
 547   2                              for (i = 0; i < (Menu_Number[0] << 1); i++)
 548   2                              {
 549   3                                      //pcTemp[i] = Uart_RecBuf[2 + i];
 550   3                                      pcTemp[i] = Uart_RecBuf[3 + i];
 551   3                              }
 552   2            
 553   2                              //²Ù×÷°åÏÂ·¢ÉèÖÃ²ÎÊý,Ö÷¿Ø°åÊÕµ½ºó·µ»Ø
 554   2                              already_read_param = 1;  /* ÖÃÎªÒÑ¶Áµ½ÅäÖÃ²ÎÊý */
 555   2      
 556   2                              send_frame_type = UP_REPLY_DONE;  /* ¿ÉÒÔ·¢ËÍÏÂÒ»Ö¡ */
 557   2                              
 558   2                      break;
 559   2      
 560   2                      /* ÉÏÐÐÐ´×´Ì¬Ö¡ */
 561   2                      //Ö÷¿Ø°å·µ»Ø°æ±¾ºÅ,io¿Ú´«¸ÐÆ÷×´Ì¬,´íÎó±êÖ¾,´êÌõ¸ùÊý
 562   2                      case UP_WRITE_STATE:
 563   2                              
 564   2                              public_val.version 
 565   2                                      = ((unsigned int)Uart_RecBuf[3] << 8) | (unsigned int)Uart_RecBuf[2];
 566   2      
 567   2                              //add 
 568   2                              unDownVerNum = public_val.version;              //Ö÷°æ±¾ºÅ              //Ö÷¿Ø°å°æ±¾ºÅ
 569   2                          if (unDownVerNum == 0)
 570   2                                      unDownVerNum = 12345;
 571   2                              //add 0323
 572   2                      
 573   2                              
 574   2                        //Ö÷¿Ø°å·µ»Øio¿Ú×´Ì¬
 575   2                              public_val.io_read
 576   2                                      = ((unsigned int)Uart_RecBuf[5] << 8) | (unsigned int)Uart_RecBuf[4];  //´«¸ÐÆ÷×´Ì¬(¿ÉÒÔ·µ»Ø16bit¶ÔÓ¦
             -16¸ö´«¸ÐÆ÷×´Ì¬)
 577   2                        //add 0320
 578   2                        //public_val.io_read = 23456;
 579   2                              unIoStatus = public_val.io_read;
 580   2                              //if (unIoStatus == 0)
 581   2                                      //unIoStatus = 1;
 582   2                              //add 0320
 583   2                      
 584   2                              //if ((Uart_RecBuf[7] != 0) || (Uart_RecBuf[6] != 0))
 585   2                              //{
 586   2                              public_val.Err_Flag 
 587   2                                      = ((unsigned int)Uart_RecBuf[7] << 8) | (unsigned int)Uart_RecBuf[6];
 588   2                              //}
 589   2      
 590   2                              //public_val.disp_cnt_upload
 591   2                      //ÉÏÐÐÐ´´êÌõ¸ùÊý,ÔÚÕâÀï¸üÐÂ: public_val.cnt_after_powered  (¿ª»úºóµÄ´êÌõ¸ùÊý),
 592   2                      //²¢½«¿ª»úºóµÄ´êÌõ¸ùÊýÓë¿ª»úÇ°µÄ´êÌõ¸ùÊýÏà¼Ó£¬±£´æµ½eeprom. call save_xt_num().
 593   2                              uiCnt
 594   2                                      = ((unsigned long)Uart_RecBuf[9] << 8) | (unsigned long)Uart_RecBuf[8]
 595   2                                      | ((unsigned long)Uart_RecBuf[11] << 24) | ((unsigned long)Uart_RecBuf[10] << 16);              //·µ»Ø´êÌõ¸ùÊý
 596   2                                      
 597   2                              
 598   2                              //add
 599   2                                      TotalNum = uiCnt;                               //ÆäÓà£¬¿ÉÖ±½ÓÊ¹ÓÃ½á¹¹public_valµÄ³ÉÔ±¸³Öµ,Èç: public_val.io_read,  public_val.ve
             -rsion
 600   2                                      //ÕâÀï¸øunRow3Data¸³Öµ,ÓÐ¿ÉÄÜÒýÆðÆäËûµÄ²é¿´ÊýÖµ±ä»¯
 601   2                                      //unRow3Data = uiCnt;
 602   2                                              //TotalNum = 1;
 603   2                                      //add 0324 20:33
C51 COMPILER V9.00   UART                                                                  05/05/2016 16:13:40 PAGE 11  

 604   2      
 605   2                              if (main_borad_finish_clear != 0)  /* ²»ÐèÒªÇå³ýÍ²ÊýÊ±²Å±£´æ¸üÐÂ */
 606   2                              {
 607   3                                      if (uiCnt != public_val.cnt_after_powered)  /* Èç¹ûÍ²ÊýÓÐ¸üÐÂ£¬Ôò±£´æ¸üÐÂ */
 608   3                                      {
 609   4                                              public_val.cnt_after_powered = uiCnt;
 610   4      
 611   4                                              save_xt_num();
*** WARNING C206 IN LINE 611 OF UART.C: 'save_xt_num': missing function-prototype
 612   4                                      }
 613   3                              }
 614   2                              
 615   2                              
 616   2      
 617   2                              if ((public_val.version == 11111) && (ucSaveLearn1 == 0))
 618   2                              {
 619   3                                      public_val.menu_parm[PARAM_FZ_START_PWM_SCALE] = (int)(uiCnt & 0xFFFF);
 620   3                                      //public_val.menu_parm[PARAM_QZ_START_PWM_SCALE] = (int)((uiCnt >> 16) & 0xFFFF);
 621   3                                      
 622   3                                      func_menu_update(0);
 623   3      
 624   3                                      ucSaveLearn1 = 1;
 625   3                              }
 626   2      
 627   2                              if ((public_val.version == 22222) && (ucSaveLearn2 == 0))
 628   2                              {
 629   3                                      public_val.menu_parm[PARAM_FZ_START_PWM_SCALE] = (int)(uiCnt & 0xFFFF);
 630   3                                      //public_val.menu_parm[PARAM_QZ_START_PWM_SCALE] = (int)((uiCnt >> 16) & 0xFFFF);
 631   3                                      
 632   3                                      func_menu_update(0);
 633   3      
 634   3                                      ucSaveLearn2 = 1;
 635   3                              }
 636   2                              
 637   2                              send_frame_type = UP_REPLY_DONE;  /* ¿ÉÒÔ·¢ËÍÏÂÒ»Ö¡ */
 638   2                              
 639   2                      break;
 640   2      
 641   2                      /* ÉÏÐÐÐ´²ÎÊý·¶Î§Ö¡ */    //Ö÷¿Ø°å·µ»Ø²ÎÊý·¶Î§
 642   2                      case UP_WRITE_PARAM_RANGE:
 643   2      
 644   2                      //´æ·ÅÔÚ²Ëµ¥ÅäÖÃ»º³å: ×î´óÖµ£¬×îÐ¡Öµµ¥Ôª
 645   2                              for (i = 0; i < (Uart_RecBuf[1] >> 2); i++)  /* ²ÎÊý¸öÊýÎªÔØºÉ³¤¶È³ýÒÔ4 */
 646   2                              {
 647   3                                      MenuItem[MENU_ID_00000].m_pcfg[i].m_min 
 648   3                                              = ((short)Uart_RecBuf[2 + (i << 2)] << 8)    /* ÏÈÊÕµÍµØÖ·×Ö½Ú */
 649   3                                                      | (short)Uart_RecBuf[2 + (i << 2) + 1]; 
 650   3                                      
 651   3                                      MenuItem[MENU_ID_00000].m_pcfg[i].m_max 
 652   3                                              = ((short)Uart_RecBuf[2 + (i << 2) + 2] << 8) 
 653   3                                                      | (short)Uart_RecBuf[2 + (i << 2) + 3];                         
 654   3                              }
 655   2      
 656   2                              //Menu_Number[0] = (Uart_RecBuf[1] >> 2);  
 657   2      
 658   2                              already_read_param_range = 1;  /* ÖÃÎªÒÑ¶Áµ½ÅäÖÃ²ÎÊý·¶Î§ */     
 659   2      
 660   2                              send_frame_type = UP_REPLY_DONE;  /* ¿ÉÒÔ·¢ËÍÏÂÒ»Ö¡ */  
 661   2      
 662   2                      break;
 663   2      
 664   2                      /* ÉÏÐÐÐ´½ÓÊÕ²ÎÊýÍê³É */
C51 COMPILER V9.00   UART                                                                  05/05/2016 16:13:40 PAGE 12  

 665   2                      case UP_WRITE_REC_PARAM_DONE:
 666   2      
 667   2                              send_frame_type = UP_REPLY_DONE;  /* ¿ÉÒÔ·¢ËÍÏÂÒ»Ö¡ */
 668   2      
 669   2                      break;
 670   2      
 671   2                      /* ÉÏÐÐÐ´½øÈë²âÊÔÄ£Ê½³É¹¦ */
 672   2                      case UP_WRITE_TEST_MODE_DONE:
 673   2      
 674   2                              send_frame_type = UP_REPLY_DONE;  /* ¿ÉÒÔ·¢ËÍÏÂÒ»Ö¡ */
 675   2      
 676   2                      break;
 677   2      
 678   2                      /* ÉÏÐÐÐ´½øÈëÑ§Ï°Ä£Ê½³É¹¦ */
 679   2                      case UP_WRITE_LEARN_MODE_DONE:
 680   2      
 681   2                              send_frame_type = UP_REPLY_DONE;  /* ¿ÉÒÔ·¢ËÍÏÂÒ»Ö¡ */
 682   2      
 683   2                      break;
 684   2      
 685   2                      /* ÉÏÐÐÐ´ÇÐ»»ËÙ¶ÈÄ£Ê½³É¹¦ */
 686   2                      case UP_WRITE_SPEED_MODE_DONE:
 687   2      
 688   2                              send_frame_type = UP_REPLY_DONE;  /* ¿ÉÒÔ·¢ËÍÏÂÒ»Ö¡ */
 689   2      
 690   2                      break;
 691   2      
 692   2                      /* ÉÏÐÐÐ´±¨¾¯ÏûÏ¢³É¹¦ */
 693   2                      case UP_WRITE_WARNING_MSG_DONE:
 694   2      
 695   2                              send_frame_type = UP_REPLY_DONE;  /* ¿ÉÒÔ·¢ËÍÏÂÒ»Ö¡ */
 696   2      
 697   2                      break;
 698   2      
 699   2      
 700   2                      /* ÉÏÐÐÐ´Çå³ýÒÑ³öÍ²Êý³É¹¦ */
 701   2                      case UP_WRITE_CLEAR_CNT_DONE:
 702   2      
 703   2                              main_borad_finish_clear = 1;      /* Ö÷°åÒÑÍê³ÉÇå³ý¼ÆÊý */
 704   2      
 705   2                              send_frame_type = UP_REPLY_DONE;  /* ¿ÉÒÔ·¢ËÍÏÂÒ»Ö¡ */
 706   2      
 707   2                      break;          
 708   2      
 709   2                      /* ÉÏÐÐÐ´°´¼ü³É¹¦ */
 710   2                      case UP_WRITE_KEY_DONE:
 711   2      
 712   2                              send_frame_type = UP_REPLY_DONE;  /* ¿ÉÒÔ·¢ËÍÏÂÒ»Ö¡ */
 713   2      
 714   2                      break;  
 715   2      
 716   2      
 717   2                      /* Ð£ÑéÊ§°ÜÖ¡£¬±¨´í */
 718   2                      case UP_WRITE_CHECK_FAIL:  
 719   2                              
 720   2                              //public_val.Err_Flag = ERR_NUM_ZK_COM_ERR;     
 721   2                              public_val.Err_Flag = MAIN_CHECK_ERROR;           /* ½ÓÊÕµ½Ð£Ñé´íÎóÖ¡ºó²»·¢ËÍºóÐøÖ¡ */  
 722   2      
 723   2                              send_frame_type = UP_REPLY_DONE;  /* ¿ÉÒÔ·¢ËÍÏÂÒ»Ö¡ */
 724   2                              
 725   2                      break;
 726   2      
C51 COMPILER V9.00   UART                                                                  05/05/2016 16:13:40 PAGE 13  

 727   2                      default:
 728   2                              
 729   2                              break;
 730   2              }
 731   1              
 732   1      }
 733          
 734          /*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 735          Ãû³Æ:   send_data_func(void)
 736          ¹¦ÄÜ£º  Í¨Ñ¶´¦Àí¹ý³Ì ÓÉÖ÷³ÌÐòµ÷ÓÃ
 737          ²ÎÊý£º  ÎÞ
 738          ·µ»ØÖµ£ºÎÞ
 739          ËµÃ÷: °æ±¾²»Æ¥Åä: »ñÈ¡²Ëµ¥ÅäÖÃÐÅÏ¢->»ñÈ¡Ä¬ÈÏ²ÎÊý->ÏÂ·¢²Ëµ¥²ÎÊý
 740                °æ±¾Æ¥Åä: ÏÂ·¢²Ëµ¥²ÎÊý
 741          ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/
 742          void send_data_func(void)
 743          {
 744   1              int i;
 745   1      
 746   1        char *pcTemp = 0;
 747   1              unsigned char sum_byte;
 748   1              
 749   1      
 750   1              /* Ã¿1s¶ÁÈ¡Ò»´ÎÖ÷°å×´Ì¬ */   //¼´io¿ÚµÄ´«¸ÐÆ÷×´Ì¬
 751   1      #if 1
 752   1              if(public_val.ms_timer - cnt_read_state > READ_STATE_PERIOD)
 753   1              {       
 754   2                      if (write_param_flag == 0)
 755   2                      {
 756   3                              if (send_frame_type == UP_REPLY_DONE)  /* ÉÏÒ»Ö¡ÒÑÊÕµ½»Ø¸´£¬Ôò·¢ËÍ¶Á×´Ì¬Ö¡ */
 757   3                              {
 758   4                                      send_frame_type = DOWN_READ_STATE;
 759   4                              }
 760   3                      }
 761   2      
 762   2                      cnt_read_state = public_val.ms_timer;
 763   2              }
 764   1      #endif
 765   1      
 766   1              /* ÒÑ¶Áµ½Ö÷°å×´Ì¬£¬ÇÒÎ´¶ÁÅäÖÃ²ÎÊý£¬Ôò¶ÁÈ¡Ò»´ÎÅäÖÃ²ÎÊý */
 767   1      #if 1   
 768   1              if ((public_val.version != 0) && (already_read_param == 0))
 769   1              {
 770   2                      //if (public_val.ms_timer - cnt_read_param > 100)
 771   2                      {               
 772   3                              if (send_frame_type == UP_REPLY_DONE)  /* ÉÏÒ»Ö¡ÒÑÊÕµ½»Ø¸´£¬Ôò·¢ËÍ¶Á²ÎÊýÖ¡ */
 773   3                              {
 774   4      
 775   4                                      //send_frame_type = DOWN_READ_PARAM;                            
 776   4      
 777   4                                      // Ð´Ä¬ÈÏ²ÎÊý
 778   4                                      Menu_Number[0] = MACHINE_PARAM_NUM;     //»úÆ÷²ÎÊý¸öÊý  22, Menu_Number[]×î´ó´æ´¢30¸ö
 779   4                                      Menu0_Number = USER_PARAM_NUM;                                  //ÓÃ»§²ÎÊý¸öÊý  2,  Menu0_Number  Ä¬ÈÏ10. Menu1_Number Ä¬ÈÏ20
 780   4      
 781   4                                      // ×îºóÒ»¸ö²ÎÊý²»ÊÇ0x55aaÔòÐ´Ò»´ÎÄ¬ÈÏ²ÎÊý
 782   4                                      if (public_val.menu_parm[MENU_ID_00000_MAX_ITEM - 1] != 0x55aa)
 783   4                                      {
 784   5                                              public_val.menu_parm[0] = 310;   //Ö½³¤                                 
 785   5                                              public_val.menu_parm[1] = 300;   /* Éè¶¨Í²Êý */
 786   5                                              
 787   5                                              public_val.menu_parm[2] = 2;     /* 1¡¢±¨¾¯³ÖÐøÊ±¼ä:s */
 788   5                                              public_val.menu_parm[3] = 15;    /* 2¡¢¶ÂÍ²¼ì²âÊ±¼ä1, Ê±»ù¸ÐÓ¦µ½¶ÂÍ²¼ì²â1¸ÐÓ¦±¨¾¯µÄÑÓ³ÙÊ±¼ä:0.1s */
C51 COMPILER V9.00   UART                                                                  05/05/2016 16:13:40 PAGE 14  

 789   5                                              public_val.menu_parm[4] = 15;    /* 3¡¢¶ÂÍ²¼ì²âÊ±¼ä2, Ê±»ù¸ÐÓ¦µ½¶ÂÍ²¼ì²â2¸ÐÓ¦±¨¾¯µÄÑÓ³ÙÊ±¼ä:0.1s */
 790   5                                              public_val.menu_parm[5] = 0;     /* 4¡¢²½½øµç»ú·½Ïò */
 791   5                                              public_val.menu_parm[6] = 0;     // 5¡¢ËÍÖ½ËÙ¶ÈÔöÒæ
 792   5                                              public_val.menu_parm[7] = 320;   /* 6¡¢²½½øµç»úÂö³åµ±Á¿:0.1¸ö/mm (4000*2 /(2*3.14*40)) ¼õËÙ±È2 */
 793   5                                              public_val.menu_parm[8] = 89;    /* 7¡¢·¢Ö½µç»úÁ´ÂÖ¼õËÙ±È */
 794   5                                              public_val.menu_parm[9] = 400;   /* 8¡¢·¢Ö½Ñ¹ÂÖ°ë¾¶:0.1mm */
 795   5                                              public_val.menu_parm[10] = 20;   /* 9¡¢·¢Ö½µç»úPIDµ÷ËÙµÄ±ÈÀýÏµÊý*100 */
 796   5                                      #ifdef SZ_01    // SZ_01
                                                      public_val.menu_parm[11] = 85;   /* 10¡¢·¢Ö½µç»úÆô¶¯PWMÕ¼¿Õ±È */
                                                      public_val.menu_parm[12] = 85;   /* 11¡¢ÇÐÖ½µç»úÆô¶¯PWMÕ¼¿Õ±È */
                                                      public_val.menu_parm[13] = 70;   /* 12¡¢ÇÐÖ½µç»úÄ¿±êPWMÕ¼¿Õ±È */
                                                      public_val.menu_parm[14] = 10;   /* 13¡¢·¢Ö½×î¸ßËÙ¶È */
                                                      public_val.menu_parm[15] = 1;    /* 14¡¢·¢Ö½×îµÍËÙ¶È */
                                                      public_val.menu_parm[16] = 40;   /* 15¡¢ËÍÖ½½Ç¶È */
                                                      public_val.menu_parm[17] = 3;    /* 16¡¢ÇÐµ¶¿ØÖÆÄ£Ê½ 3:Æß¶Îµ÷ËÙ */
                                                      public_val.menu_parm[18] = 84;   /* 17¡¢ÇÐÖ½Í£Ö¹ËÙ¶È */
                                                      public_val.menu_parm[19] = 1;    /* 18¡¢±¸ÓÃ */
                                                      public_val.menu_parm[20] = 1;    /* 19¡¢±¸ÓÃ */
                                                      public_val.menu_parm[21] = 60;   /* 20¡¢µ÷ËÙ×î¸ßËÙ¶È */
                                              #endif
 809   5                                              
 810   5                                      #ifdef SZ_02            // SZ_02
 811   5                                              public_val.menu_parm[11] = 84;   /* 10¡¢·¢Ö½µç»úÆô¶¯PWMÕ¼¿Õ±È */                                
 812   5                                              public_val.menu_parm[12] = 2;    /* 11¡¢ÇÐÖ½µç»úÁ´ÂÖ¼õËÙ±È */
 813   5                                              public_val.menu_parm[13] = 120;  /* 12¡¢ÇÐÖ½µç»úÄ¿±êËÙ¶È:0.1khz */
 814   5                                              public_val.menu_parm[14] = 10;   /* 13¡¢·¢Ö½×î¸ßËÙ¶È */
 815   5                                              public_val.menu_parm[15] = 1;    /* 14¡¢·¢Ö½×îµÍËÙ¶È */
 816   5                                              public_val.menu_parm[16] = 73;   /* 15¡¢ËÍÖ½½Ç¶È:0.1kÂö³å */
 817   5                                              public_val.menu_parm[17] = 1;    /* 16¡¢±¸ÓÃ */
 818   5                                              public_val.menu_parm[18] = 1;    /* 17¡¢±¸ÓÃ */
 819   5                                              public_val.menu_parm[19] = 1;    /* 18¡¢±¸ÓÃ */
 820   5                                              public_val.menu_parm[20] = 1;    /* 19¡¢±¸ÓÃ */                                 
 821   5                                              public_val.menu_parm[21] = 1;    /* 20¡¢±¸ÓÃ */                                 
 822   5                                      #endif
 823   5      
 824   5                                      #ifdef SZ_03
                                                      public_val.menu_parm[3] = 30;    /* 2¡¢¶ÂÍ²¼ì²âÊ±¼ä1, Ê±»ù¸ÐÓ¦µ½¶ÂÍ²¼ì²â1¸ÐÓ¦±¨¾¯µÄÑÓ³ÙÊ±¼ä:0.1s */
                                                      public_val.menu_parm[4] = 30;    /* 3¡¢¶ÂÍ²¼ì²âÊ±¼ä2, Ê±»ù¸ÐÓ¦µ½¶ÂÍ²¼ì²â2¸ÐÓ¦±¨¾¯µÄÑÓ³ÙÊ±¼ä:0.1s */
                                                      public_val.menu_parm[5] = 1;     /* 4¡¢²½½øµç»ú·½Ïò */
                                                      public_val.menu_parm[6] = 20;    // 5¡¢ËÍÖ½ËÙ¶ÈÔöÒæ                                     
                                                      public_val.menu_parm[7] = 490;   /* 6¡¢ ËÍÖ½²½½øµç»úÂö³åµ±Á¿:0.1¸ö/mm (4000*(36/12) /(2*3.14*39)) ¼õË
             -Ù±È36/12 */
                                                      public_val.menu_parm[8] = 1;     /* 7¡¢ÇÐÖ½µç»úÁ´ÂÖ¼õËÙ±È */
                                                      public_val.menu_parm[9] = 150;   /* 8¡¢ÇÐÖ½µç»úÄ¿±êËÙ¶È:0.1khz */
                                                      public_val.menu_parm[10] = 37;   /* 9¡¢ËÍÖ½½Ç¶È:0.1kÂö³å */
                                                      public_val.menu_parm[11] = 1;    /* 10¡¢±¸ÓÃ */
                                                      public_val.menu_parm[12] = 1;    /* 11¡¢±¸ÓÃ */
                                                      public_val.menu_parm[13] = 1;    /* 12¡¢±¸ÓÃ */
                                                      public_val.menu_parm[14] = 1;    /* 13¡¢±¸ÓÃ */ 
                                                      public_val.menu_parm[15] = 1;    /* 14¡¢±¸ÓÃ */
                                                      public_val.menu_parm[16] = 1;    /* 15¡¢±¸ÓÃ */ 
                                                      public_val.menu_parm[17] = 1;    /* 16¡¢±¸ÓÃ */
                                                      public_val.menu_parm[18] = 1;    /* 17¡¢±¸ÓÃ */
                                                      public_val.menu_parm[19] = 1;    /* 18¡¢±¸ÓÃ */
                                                      public_val.menu_parm[20] = 1;    /* 19¡¢±¸ÓÃ */ 
                                                      public_val.menu_parm[21] = 1;    /* 20¡¢±¸ÓÃ */                                         //public_val.menu_parm:Ä¬ÈÏ²ÎÊý
                                              #endif
 845   5      
 846   5      
 847   5                                              public_val.menu_parm[MENU_ID_00000_MAX_ITEM - 1] = 0x55aa;                                      
 848   5      
 849   5                                              func_menu_update(0);            ////¸üÐÂÄ¬ÈÏ²ÎÊý
C51 COMPILER V9.00   UART                                                                  05/05/2016 16:13:40 PAGE 15  

 850   5                                              
 851   5                                      }
 852   4      
 853   4                                      write_param_flag = 1;    // ¸üÐÂÏÂÎ»»ú²ÎÊý
 854   4      
 855   4                                      already_read_param = 1;  /* ÖÃÎªÒÑ¶Áµ½ÅäÖÃ²ÎÊý */
 856   4      
 857   4                                      send_frame_type = UP_REPLY_DONE;  /* ¿ÉÒÔ·¢ËÍÏÂÒ»Ö¡ */                          
 858   4                                      
 859   4                              }
 860   3      
 861   3                              //cnt_read_param = public_val.ms_timer;
 862   3                      }
 863   2              }
 864   1      #endif  
 865   1      
 866   1              /* ÒÑ¶Áµ½ÅäÖÃ²ÎÊý£¬ÇÒÎ´¶ÁÅäÖÃ²ÎÊý·¶Î§£¬Ôò¶ÁÈ¡Ò»´ÎÅäÖÃ²ÎÊý·¶Î§ */
 867   1              // Ö÷°åÒÑÊÕµ½²Ù×÷Ãæ°åÏÂ·¢µÄÉèÖÃ²ÎÊý,µ«Î´ÊÕµ½¶Á²ÎÊýÅäÖÃ·¶Î§,ÖÃ·¢ËÍÖ¡ÀàÐÍsend_frame_typeÎª¶Á²ÎÊý·¶Î§
 868   1      #if 1   
 869   1              if ((already_read_param == 1) && (already_read_param_range == 0))
 870   1              {
 871   2                      //if (public_val.ms_timer - cnt_read_param > 100)
 872   2                      {               
 873   3                              if (send_frame_type == UP_REPLY_DONE)  /* ÉÏÒ»Ö¡ÒÑÊÕµ½»Ø¸´£¬Ôò·¢ËÍ¶Á²ÎÊýÖ¡ */
 874   3                              {
 875   4                                      send_frame_type = DOWN_READ_PARAM_RANGE;
 876   4                              }
 877   3      
 878   3                              //cnt_read_param = public_val.ms_timer;
 879   3                      }
 880   2              }
 881   1      #endif  
 882   1      
 883   1      
 884   1              /* µ±Ç°ÐèÒª±£´æÅäÖÃ²ÎÊýµ½Ö÷°å */
 885   1      #if 1
 886   1              if (write_param_flag != 0)   //½øÐÐ²ÎÊýÐÞ¸ÄÊ±,Ã¿ÐÞ¸ÄÒ»¸ö²ÎÊýÈ·¶¨,¸üÐÂÏÂÎ»»ú²ÎÊý  ¶¼ÓëÖ÷¿Ø°å½øÐÐÍ¨ÐÅ¸üÐÂ²Î
             -Êý
 887   1              {
 888   2                      if (send_frame_type == UP_REPLY_DONE)  /* ÉÏÒ»Ö¡ÒÑÊÕµ½»Ø¸´£¬Ôò·¢ËÍÐ´²ÎÊýÖ¡ */
 889   2                      {
 890   3                              send_frame_type = DOWN_WRITE_PARAM;
 891   3                      }
 892   2              }
 893   1      #endif
 894   1      
 895   1      
 896   1              /* µ±Ç°ÐèÒªÐ´Ñ§Ï°Ä£Ê½µ½Ö÷°å */
 897   1      #if 1
 898   1              if (write_learn_mode_flag != 0)
 899   1              {
 900   2                      if (send_frame_type == UP_REPLY_DONE)  /* ÉÏÒ»Ö¡ÒÑÊÕµ½»Ø¸´£¬Ôò·¢ËÍÐ´²âÊÔÄ£Ê½Ö¡ */
 901   2                      {
 902   3                              send_frame_type = DOWN_WRITE_LEARN_MODE;
 903   3                      }
 904   2              }
 905   1      #endif
 906   1      
 907   1      #if 1
 908   1              if (write_warning_flag != 0)
 909   1              {
 910   2                      if (send_frame_type == UP_REPLY_DONE)  /* ÉÏÒ»Ö¡ÒÑÊÕµ½»Ø¸´£¬Ôò·¢ËÍÐ´²âÊÔÄ£Ê½Ö¡ */
C51 COMPILER V9.00   UART                                                                  05/05/2016 16:13:40 PAGE 16  

 911   2                      {
 912   3                              send_frame_type = DOWN_WRITE_WARNING_MSG;
 913   3                      }
 914   2              }
 915   1      #endif
 916   1      
 917   1      
 918   1      
 919   1              /* µ±Ç°ÐèÒªÐ´²âÊÔÄ£Ê½µ½Ö÷°å */
 920   1      #if 1
 921   1              if (write_test_mode_flag != 0)
 922   1              {
 923   2                      if (send_frame_type == UP_REPLY_DONE)  /* ÉÏÒ»Ö¡ÒÑÊÕµ½»Ø¸´£¬Ôò·¢ËÍÐ´²âÊÔÄ£Ê½Ö¡ */
 924   2                      {
 925   3                              send_frame_type = DOWN_WRITE_TEST_MODE;
 926   3                      }
 927   2              }
 928   1      #endif
 929   1      
 930   1              /* µ±Ç°ÐèÒªÐ´ËÙ¶ÈÄ£Ê½µ½Ö÷°å */
 931   1      #if 1
 932   1              if (write_speed_mode_flag != 0)
 933   1              {
 934   2                      if (send_frame_type == UP_REPLY_DONE)  /* ÉÏÒ»Ö¡ÒÑÊÕµ½»Ø¸´£¬Ôò·¢ËÍÐ´²âÊÔÄ£Ê½Ö¡ */
 935   2                      {
 936   3                              send_frame_type = DOWN_WRITE_SPEED_MODE;
 937   3                      }
 938   2              }
 939   1      #endif
 940   1      
 941   1      
 942   1              /* µ±Ç°ÐèÒªÐ´Çå³ýÒÑ³öÍ²ÊýÖ÷°å */
 943   1      #if 1
 944   1              if (write_clear_cnt_flag != 0)
 945   1              {
 946   2                      if (send_frame_type == UP_REPLY_DONE)  /* ÉÏÒ»Ö¡ÒÑÊÕµ½»Ø¸´£¬Ôò·¢ËÍÐ´²âÊÔÄ£Ê½Ö¡ */
 947   2                      {
 948   3                              send_frame_type = DOWN_WRITE_CLEAR_CNT;
 949   3                      }
 950   2              }
 951   1      #endif
 952   1      
 953   1              /* µ±Ç°ÐèÒªÐ´°´¼üµ½Ö÷°å */
 954   1      #if 1
 955   1              if (write_key_flag != 0)
 956   1              {
 957   2                      if (send_frame_type == UP_REPLY_DONE)  /* ÉÏÒ»Ö¡ÒÑÊÕµ½»Ø¸´£¬Ôò·¢ËÍÐ´°´¼üÖ¡ */
 958   2                      {
 959   3                              send_frame_type = DOWN_WRITE_KEY;
 960   3                      }
 961   2              }       
 962   1      #endif
 963   1      
 964   1              /* ·¢ËÍ×éÖ¡ */
 965   1              switch (send_frame_type)
 966   1              {
 967   2                      case DOWN_READ_PARAM:  /* ÏÂÐÐ¶Á²ÎÊýÖ¡ */
 968   2                              memset(uart_send_buf, 0, sizeof(uart_send_buf));
 969   2                              
 970   2                              uart_send_buf[0] = DOWN_READ_PARAM;
 971   2                              uart_send_buf[1] = 1;                   
 972   2                              uart_send_buf[2] = 0;
C51 COMPILER V9.00   UART                                                                  05/05/2016 16:13:40 PAGE 17  

 973   2                              uart_send_buf[3] = 1;
 974   2      
 975   2                              Send_UartBuf(uart_send_buf);
 976   2      
 977   2                              send_frame_type = DOWN_READ_PARAM_SENT;   /* ÖÃÎª¶Á²ÎÊýÖ¡ÒÑ·¢ËÍ */
 978   2                              
 979   2                              break;
 980   2      
 981   2                      //ÏÂ·¢¶Á×´Ì¬,Ö÷¿Ø°å·µ»ØÏàÓ¦×´Ì¬
 982   2                      case DOWN_READ_STATE:  /* ÏÂÐÐ¶Á×´Ì¬ */   //Ã¿¼ä¸ô1s¶ÁÈ¡Ö÷°å×´Ì¬
 983   2                              memset(uart_send_buf, 0, sizeof(uart_send_buf));
 984   2                              
 985   2                              uart_send_buf[0] = DOWN_READ_STATE;
 986   2                              uart_send_buf[1] = 1;                   
 987   2                              uart_send_buf[2] = 0;
 988   2                              uart_send_buf[3] = 2;
 989   2      
 990   2                              Send_UartBuf(uart_send_buf);
 991   2      
 992   2                              send_frame_type = DOWN_READ_STATE_SENT;   /* ÖÃÎª¶Á×´Ì¬Ö¡ÒÑ·¢ËÍ */
 993   2                              
 994   2                              break;
 995   2      
 996   2                      case DOWN_READ_PARAM_RANGE:  /* ÏÂÐÐ¶Á²ÎÊý·¶Î§ */
 997   2                              memset(uart_send_buf, 0, sizeof(uart_send_buf));
 998   2      
 999   2                              uart_send_buf[0] = DOWN_READ_PARAM_RANGE;
1000   2                              uart_send_buf[1] = 1;                   
1001   2                              uart_send_buf[2] = 0;
1002   2                              uart_send_buf[3] = 4;           
1003   2      
1004   2                              Send_UartBuf(uart_send_buf);
1005   2      
1006   2                              send_frame_type = DOWN_READ_PARAM_RANGE_SENT;   /* ÖÃÎª¶Á²ÎÊý·¶Î§Ö¡ÒÑ·¢ËÍ */
1007   2      
1008   2                              
1009   2                              break;
1010   2      
1011   2      
1012   2                      //ÏòÖ÷¿Ø°å·¢ËÍÒÑÅäÖÃµÄ²ÎÊý
1013   2                      case DOWN_WRITE_PARAM:  /* ÏÂÐÐÐ´ÅäÖÃ²ÎÊý */
1014   2                              memset(uart_send_buf, 0, sizeof(uart_send_buf));                        
1015   2      
1016   2                              uart_send_buf[0] = DOWN_WRITE_PARAM;
1017   2                              uart_send_buf[1] = Menu_Number[0] << 1; 
1018   2      
1019   2                              pcTemp = (char *)&public_val.menu_parm[0];   //½«ËùÓÐ²ÎÊý½øÐÐÒ»´Î¸üÐÂ
1020   2      
1021   2                              sum_byte = uart_send_buf[0] + uart_send_buf[1];                 
1022   2                              
1023   2                              for (i = 0; i < (Menu_Number[0] << 1); i++)
1024   2                              {
1025   3                                      uart_send_buf[2 + i] = pcTemp[i];
1026   3      
1027   3                                      /* ¼ÆËãÐ£ÑéºÍ */
1028   3                                      sum_byte += pcTemp[i];                          
1029   3                              }
1030   2                              
1031   2                              //sum_byte &= 0xff;
1032   2                              
1033   2                              uart_send_buf[2 + (Menu_Number[0] << 1)] = sum_byte;
1034   2              
C51 COMPILER V9.00   UART                                                                  05/05/2016 16:13:40 PAGE 18  

1035   2                              Send_UartBuf(uart_send_buf);
1036   2      
1037   2                              send_frame_type = DOWN_WRITE_PARAM_SENT;   /* ÖÃÎªÐ´²ÎÊýÖ¡ÒÑ·¢ËÍ */
1038   2      
1039   2      
1040   2                              write_param_flag = 0;  /* ÒÑÍê³ÉÒ»´ÎÐ´ÅäÖÃ²ÎÊý£¬ÖÃÎª²»Ð´×´Ì¬ */ 
1041   2                              
1042   2                              break;
1043   2      
1044   2                      case DOWN_WRITE_TEST_MODE:  /* ÏÂÐÐÐ´½øÈë²âÊÔÄ£Ê½ */
1045   2                              memset(uart_send_buf, 0, sizeof(uart_send_buf));                        
1046   2      
1047   2                              uart_send_buf[0] = DOWN_WRITE_TEST_MODE;
1048   2                              uart_send_buf[1] = 1;                   
1049   2                              uart_send_buf[2] = test_mode;
1050   2                              uart_send_buf[3] = 5 + test_mode;               
1051   2      
1052   2                              Send_UartBuf(uart_send_buf);
1053   2      
1054   2                              send_frame_type = DOWN_WRITE_TEST_MODE_SENT;   /* ÖÃÎªÐ´²âÊÔÄ£Ê½Ö¡ÒÑ·¢ËÍ */                     
1055   2      
1056   2                              write_test_mode_flag = 0;  /* ÒÑÍê³ÉÒ»´ÎÐ´²âÊÔÄ£Ê½£¬ÖÃÎª²»Ð´×´Ì¬ */     
1057   2      
1058   2                              break;
1059   2      
1060   2                      case DOWN_WRITE_LEARN_MODE:  /* ÏÂÐÐÐ´½øÈëÑ§Ï°Ä£Ê½ */
1061   2                              memset(uart_send_buf, 0, sizeof(uart_send_buf));                        
1062   2      
1063   2                              uart_send_buf[0] = DOWN_WRITE_LEARN_MODE;
1064   2                              uart_send_buf[1] = 1;                   
1065   2                              uart_send_buf[2] = 0;  // no use
1066   2                              uart_send_buf[3] = 8;           
1067   2      
1068   2                              Send_UartBuf(uart_send_buf);
1069   2      
1070   2                              send_frame_type = DOWN_WRITE_LEARN_MODE_SENT;   /* ÖÃÎªÐ´Ñ§Ï°Ä£Ê½Ö¡ÒÑ·¢ËÍ */                    
1071   2      
1072   2                              write_learn_mode_flag = 0;  /* ÒÑÍê³ÉÒ»´ÎÐ´Ñ§Ï°Ä£Ê½£¬ÖÃÎª²»Ð´×´Ì¬ */    
1073   2      
1074   2                              break;
1075   2      
1076   2                      case DOWN_WRITE_SPEED_MODE:  /* ÏÂÐÐÐ´ÇÐ»»ËÙ¶ÈÄ£Ê½ */
1077   2      
1078   2                              memset(uart_send_buf, 0, sizeof(uart_send_buf));                        
1079   2      
1080   2                              uart_send_buf[0] = DOWN_WRITE_SPEED_MODE;
1081   2                              uart_send_buf[1] = 1;                   
1082   2                              uart_send_buf[2] = speed_mode;  
1083   2                              uart_send_buf[3] = 9 + speed_mode;              
1084   2      
1085   2                              Send_UartBuf(uart_send_buf);
1086   2      
1087   2                              send_frame_type = DOWN_WRITE_SPEED_MODE_SENT;   /* ÖÃÎªÐ´ËÙ¶ÈÄ£Ê½Ö¡ÒÑ·¢ËÍ */                    
1088   2      
1089   2                              write_speed_mode_flag = 0;  /* ÒÑÍê³ÉÒ»´ÎÐ´ËÙ¶ÈÄ£Ê½£¬ÖÃÎª²»Ð´×´Ì¬ */    
1090   2      
1091   2      
1092   2                              break;
1093   2      
1094   2                      case DOWN_WRITE_WARNING_MSG:
1095   2      
1096   2                              memset(uart_send_buf, 0, sizeof(uart_send_buf));                        
C51 COMPILER V9.00   UART                                                                  05/05/2016 16:13:40 PAGE 19  

1097   2      
1098   2                              uart_send_buf[0] = DOWN_WRITE_WARNING_MSG;
1099   2                              uart_send_buf[1] = 1;                   
1100   2                              uart_send_buf[2] = 0;   // no use
1101   2                              uart_send_buf[3] = 10;          
1102   2      
1103   2                              Send_UartBuf(uart_send_buf);
1104   2      
1105   2                              send_frame_type = DOWN_WRITE_WARNING_MSG_SENT;   
1106   2      
1107   2                              write_warning_flag = 0;  
1108   2      
1109   2                              break;
1110   2      
1111   2                      case DOWN_WRITE_CLEAR_CNT:  /* ÏÂÐÐÐ´Çå³ýÒÑ³öÍ²Êý */
1112   2                              memset(uart_send_buf, 0, sizeof(uart_send_buf));                        
1113   2      
1114   2                              uart_send_buf[0] = DOWN_WRITE_CLEAR_CNT;
1115   2                              uart_send_buf[1] = 1;                   
1116   2                              uart_send_buf[2] = 0;
1117   2                              uart_send_buf[3] = 6;           
1118   2      
1119   2                              Send_UartBuf(uart_send_buf);
1120   2      
1121   2                              send_frame_type = DOWN_WRITE_CLEAR_CNT_SENT;                    
1122   2      
1123   2                              write_clear_cnt_flag = 0;  
1124   2      
1125   2                              break;
1126   2      
1127   2                      case DOWN_WRITE_KEY:  /* ÏÂÐÐÐ´°´¼ü²Ù×÷ */
1128   2                              memset(uart_send_buf, 0, sizeof(uart_send_buf));                        
1129   2      
1130   2                              uart_send_buf[0] = DOWN_WRITE_KEY;
1131   2                              uart_send_buf[1] = 3;                   
1132   2                              uart_send_buf[2] = (char)gsKeyVal;
1133   2                              uart_send_buf[3] = (char)(gsKeyVal >> 8);
1134   2                              uart_send_buf[4] = gcKeyType;                   
1135   2                              uart_send_buf[5] = 9 + uart_send_buf[2] + uart_send_buf[3] 
1136   2                                      + uart_send_buf[4];
1137   2      
1138   2                              Send_UartBuf(uart_send_buf);
1139   2      
1140   2                              send_frame_type = DOWN_WRITE_KEY_SENT;                          
1141   2      
1142   2                              write_key_flag = 0;  
1143   2      
1144   2                              break;
1145   2      
1146   2                      default:
1147   2                              break;
1148   2              }
1149   1      
1150   1      
1151   1              //if (send_frame_type != 0x7f)     /* ÓÐÖ¡Òª·¢ËÍ */
1152   1              //{             
1153   1              //      Send_UartBuf(uart_send_buf);  //deleted for test
1154   1      
1155   1                      //send_frame_type = 0x7f;      /* ·¢ËÍÍê³É£¬ÖÃÎªÎÞÐ§Ö¡£¬ÎÞÖ¡·¢ËÍ */
1156   1              //}
1157   1              
1158   1      }
C51 COMPILER V9.00   UART                                                                  05/05/2016 16:13:40 PAGE 20  

1159          
1160          
1161          
1162          //´®¿ÚÆÁ²Ù×÷
1163          //µÚÒ»´ÎÊ¹ÓÃ´®¿ÚÖúÊÖ(Commix 1.4)(Ê¹ÓÃ×Ö·û´®·½Ê½)(by enter ÊÇ·ñ´ò¹³Ã»Ê²Ã´Çø±ð)·¢ËÍÈçÏÂÃüÁî³É¹¦:
1164          //CLS(0);\x0d\x0a
1165          //µÚ¶þ´Î·¢ËÍ³É¹¦
1166          //DS48(0,0,'ÏÔÊ¾×Ö·û´®',1);\x0d\x0a
1167          
1168          //²âÊÔ³ÌÐò
1169          //¸ÄÐ´³ÌÐò,³õÊ¼»¯usart2ºó,·¢ËÍÈçÉÏÃüÁî:
1170          //CLS(0);\x0d\x0a
1171          //DS48(0,0,'ÏÔÊ¾×Ö·û´®',1);\x0d\x0a
1172          //¿´Ð§¹ûÈçºÎ
1173          
1174          //GpuSend("PL(0,80,320,80,11);\r\n");
1175          
1176          //sprintf(buf,"ICON(%d,165,1,11,1,10);DS16(%d,224,' --- ',4);BOXF(%d,31,%d,79,0);BOXF(%d,81,%d,129,0);",54
             -*i,54*i+4,x1,x2,x1,x2);
1177          //                              GpuSend(buf);
1178          
1179          //GpuSend("CLS(13);BOX(0,0,219,175,15);BOX(1,1,218,174,0);BOXF(2,2,217,17,3);PL(2,18,218,18,0);\r\n");
1180                  
1181          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2108    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     36    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10      19
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
